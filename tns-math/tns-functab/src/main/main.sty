% == PACKAGES == %

\RequirePackage{nicematrix}%
               [6.26]


% == TOOLS == %

\ExplSyntaxOn

% -- FUNCTABLE ENV. - MAIN API -- %

% :: \L3 INTERFACE :: %

%%%
% prototype::
%     #1 : the user's settings (see below).
%     #2 : the DSL code of the table.
%
%     :action: an internal version of the information given via the DSL
%              is created, and then, unless otherwise stated, the table
%              corresponding to the data is produced.
%
%     :see: l3func.tns_functab_functable:nn
%
%
% =================
% Available options
% =================
%
% XXXX
%%%
\NewDocumentEnvironment{ functable }{ O{} b }{%
  \tns_functab_functable:nn { #1 } { #2 }
}{}


% :: MESSAGES :: %

\msg_set:nnnn { tnsfunctab } { unknown-context }
  { illegal ~ context ~ << ~ #2 ~ >> ~ : ~ see ~ the ~ context ~ nb.#1. }
  { \msg_see_documentation_text:n { tnsfunctab } }


% :: \L3 MAIN IMPLEMENTATION :: %

% The IDs of the env.
\int_new:N        \g_tns_functab_id_int
\int_set:Nn       \g_tns_functab_id_int { 0 }
% \prop_clear_new:N \g_tns_functab_id_user_prop

% Semantic of the env.
\seq_new:N \g_tns_functab_kind_seq
\int_new:N \l_tns_functab_context_actual_nb_int

% Shortname of contexts.
\prop_clear_new:N  \g_tns_functab_shortname_ctxts_prop

\prop_set_from_keyval:Nn \g_tns_functab_shortname_ctxts_prop {
  i = imgs,
  m = mat,
  s = signs,
  v = vars,
  x = xvals,
  y = yvals
}


%%%
% prototype::
%     :action: the work expected by the `functable` \env.
%
%     :see: env.functable ,
%           l3func.tns_core_DSL_ctxt_parser:nn
%%%
\cs_new:Npn \tns_functab_functable:nn #1#2 {
% TODO
% Options to use.


% Internal ID number.
  \int_gincr:N \g_tns_functab_id_int

% Parsing the agnostic "context" DSL code.
  \tns_core_DSL_ctxt_parser:nnN
    { -:- functable.pre.parsing.contexts -:- } % Temporary ID
    { #2 }
    { \g_tns_functab_shortname_ctxts_prop }

% -------------
% DEBUG - START

  \seq_show:c { -:- functable.pre.parsing.contexts -:- :: contexts }
%   \seq_show:c { -:- functable.pre.parsing.contexts -:- :: labels }
%   \seq_show:c { -:- functable.pre.parsing.contexts -:- :: contents }

% DEBUG - END
% -----------

% Do we have a legal DSL code?
  \tns_functab_validate_functable:n

% Let's do what the user wants.
  \par
  {\hfill \Huge TODO}
}


% :: VALIDATION OF A FUNC. TABLE :: %

%%%
% prototype::
%     :action: ??? porducton of internal version (taht could be used later iwithout reparsing)
%%%
\cs_new:Npn \tns_functab_validate_functable:n {
% Good use of the contexts?
  \int_zero:N \l_tns_functab_context_actual_nb_int

  \seq_map_inline:cn { -:- functable.pre.parsing.contexts -:- :: contexts } {
    \int_incr:N \l_tns_functab_context_actual_nb_int

    \par

    \str_case_e:nnF { ##1 } {
% XVALS
      { xvals } {
        OK: ##1
      }
% YVALS
      { yvals } {
        OK: ##1
      }
% 1D-DATA
      { imgs } {
        OK: ##1
      }
% 2D-DATA
      { mat } {
        OK: ##1
      }
% UNKNOWN CONTEXT
%
% Let's be silent with the missing contexts that have been already
% indicated by the context DSL parser.
      { :-: ctxt-dsl-missing-context :-: } { }
    }{
      \msg_error:nnVn { tnsfunctab }
                      { unknown-context }
                      { \int_use:N \l_tns_functab_context_actual_nb_int }
                      { ##1 }
    }
  }
}


% :: \L3 SIGNS :: %


% :: \L3 VARIATIONS :: %


\ExplSyntaxOff
